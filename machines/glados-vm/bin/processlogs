#!/bin/bash

function usage {
    echo "Usage: processlogs rule outfile log1 log2 log3...logN"
}

if [[ -z "$1" ]]
then
    usage
    exit 1
fi

rule="$1"
shift
outfile="$1"
if [[ -z $outfile ]]
then
    echo "Outfile not specified"
    usage
    exit 1
fi

shift
while (( "$#")); do
    filename="$1"
    echo "Processing $filename"
    echo "*********   START OF LOGFILE $filename ********" >> $outfile
    extension="${filename##*.}"
    if [[ $extension == "gz" ]]
    then
        zcat $filename | logclean.py -r=$rule -- >> $outfile
    else
        cat $filename | logclean.py -r=$rule -- >> $outfile
    fi
    shift
done
echo "$outfile written"
